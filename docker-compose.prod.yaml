version: "3.7"

services:
  spip:
    restart: always
    networks:
      - db
      - traefik
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.spip.rule=Host(`${COMPOSE_PROJECT_NAME:-spip}.${DOMAIN_NAME:-recette.tech}`)"
      - "traefik.http.routers.spip.entrypoints=https"
      - "traefik.http.routers.spip.service=spip"
      - "traefik.http.services.spip.loadbalancer.server.port=80"
      - "traefik.docker.network=${TRAEFIK_NETWORK}"

      - "traefik.http.routers.spip.tls.certresolver=myresolver"

  phpmyadmin:
    restart: always
    networks:
      - db
      - traefik
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.pma.rule=Host(`pma-${COMPOSE_PROJECT_NAME:-spip}.${DOMAIN_NAME:-recette.tech}`)"
      - "traefik.http.routers.pma.entrypoints=https"
      - "traefik.http.routers.pma.service=pma"
      - "traefik.http.services.pma.loadbalancer.server.port=80"
      - "traefik.docker.network=${TRAEFIK_NETWORK}"

      - "traefik.http.routers.pma.tls.certresolver=myresolver"

  db:
    networks:
      - db

networks:
  db:
  traefik:
    external:
      name: "${TRAEFIK_NETWORK}"
